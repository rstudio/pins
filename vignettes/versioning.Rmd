---
title: "Versioned pins"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Versioned pins}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

# Fake testing so that we get consistent hashes
Sys.setenv("TESTTHAT" = "true")
```

## Versioned pins

In many situations it's useful to version pins, so that writing to existing pin does not replace the existing data, but instead adds a new copy.
This gives you to the ability to undo mistakes or re-run historical reports.
This vignette will show you the basics of using versioning pins.

```{r setup}
library(pins)
```

## Enabling versioning

There are two ways to turn versioning on:

-   When you create a board you can turn versioning on for every pin in that board:

    ```{r}
    board <- board_temp(versions = TRUE)
    ```

-   When you write a pin, you can specifically request that versioning be turned on for that pin:

    ```{r}
    board <- board_temp()
    board %>% pin_write(mtcars, versioned = TRUE)
    ```

Some board, like `board_rsconnect()` have versioning on by default, because it's automatically supported by the underlying storage engine.
In most cases, however, you'll need to explicitly enable it.

Pins does not currently provide any tool to remove old versions, but this seems like it would be a useful feature.

## Working with versions

Once you have turned versioning on, every `pin_write()` will create a new version:

```{r}
board <- board_temp(versions = TRUE)

board %>% pin_write(1:5, name = "x", type = "rds")
board %>% pin_write(2:6, name = "x", type = "rds")
board %>% pin_write(3:7, name = "x", type = "rds")
```

You can list all the available versions with `pin_versions()`:

```{r}
board %>% pin_versions("x")
```

The exact data returned will depend on the board.

By default, `pin_read()` will return the most recent version:

```{r}
board %>% pin_read("x")
```

But you can request an older version by supplying the `version` argument:

```{r}
board %>% pin_read("x", version = "ab444e71e875d63b")
```

## Other functions

`pin_download()` and `pin_meta()` work in the same way as `pin_read()`.
